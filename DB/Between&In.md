### BETWEEN 연산 VS IN 연산자
- `between` 연산자와 `in` 연산자는 데이터 검색을 위해 사용하는 SQL 연산자이다.
- 정통 CS와는 거리가 조금 있지만, 두 연산자의 차이점과 주의깊게 보면 좋을 내용들을 정리해본다.
- 해당 내용은 `Real MySQL 8.0`을 기반으로 작성되었다.


<br>  

## BETWEEN
- '크거나 같다' + '작거나 같다' 의 의미를 가진 비교 연산자이다.
- 값의 비교를 위해 해당 범위 내의 모든 인덱스를 검색 후 결과를 반환한다.
- 해당 연산자에 대한 간단한 스니펫은 다음과 같다.
  - 10세 이상 20세 이하의 모든 유저를 검색하기 위한 쿼리 
    ``` sql
    select * 
    from user
    where age between 10 and 20
    ``` 

<br>

## IN
- 제시되는 리스트의 값 중 어느 하나라도 일치하는 데이터를 검색하는 연산자이다.
- 동등 비교, 즉 `=` 연산자와 동일하게 작동한다.
- 리스트에 상수 혹은 서브 쿼리가 사용된다. 
- 해당 연산자에 대한 간단한 스니펫은 다음과 같다.
  - 10세 이상 20세 이하의 모든 유저를 검색하기 위한 쿼리 
    ``` sql
    select * 
    from user
    where age in (10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20)
    ``` 

<br>

## 두 연산자의 동작 방식
`dept_emp` 라는 테이블이 `(dept_no, emp_no)` 라는 PK를 가진다고 가정해본다.

1. PK가 ('d003', 10001)인 레코드 검색하기
   ```sql
   select * from dept_emp
   where dept_no = 'd003' and emp_no = 10001;
   ```
2. dept_no가 'd003' ~ 'd005'인 레코드 검색하기 (between)
   - dept_no가 'd003' 이상 'd005' 이하인 모든 레코드를 읽어야 한다.
   - 때문에, emp_no에 대한 조건문이 검색 범위를 좁히는 데에 기여하지 못한다.
   ```sql
   select * from dept_emp
   where dept_no between 'd003' and 'd005' and emp_no = 10001;
   ```
3. dept_no가 'd003' ~ 'd005'인 레코드 검색하기 (in)
   - 여러 번의 동등 비교 연산을 수행해 데이터를 검색한다.
   - `('d003', 10001)`, `('d004', 10001)`, `('d005', 10001)` 이 세 개의 데이터와 해당 레코드가 일치하는지만 파악하기 때문에 2번 쿼리보다 훨씬 효과적이다.
   - 2번 쿼리와 다르게, emp_no에 대한 조건문이 검색 범위를 줄이는 데에 기여하고 있다.
   ```sql
   select * from dept_emp
   where dept_no IN ('d003', 'd004', 'd005') and emp_no = 10001; 
   ```
   ```sql
   select * from dept_emp
   where dept_no IN (
      select dept_no from departments
      where dept_no between 'd003' and 'd005' )
   and emp_no = 10001;
   ```

## 기타
- `in`, `between` 연산자는 인덱스 레인지 방식으로 스캔한다.
- `NOT IN` 연산자는 **부정형 비교를 사용**하기 때문에 explain을 이용해 계획 확인 시 인덱스 풀 스캔으로 표시된다.
  - 종종 인덱스 레인지 스캔으로 표시되는 경우가 있으나, 이는 InnoDB에 의한 표시일 뿐 실제 IN 연산자와 같은 실행 계획을 의미하지는 않는다. 
- 위의 예제는 두 칼럼이 함께 PK를 이루고 있는 상황을 가정한 것이지만, 이외의 다른 검색 기능에서도 해당 연산자들의 성능을 고려해 적절한 쿼리를 작성하는 것이 성능 향상에 도움이 될 것이다 .!.!
  - 특히 `explain` 절을 이용해 각 쿼리의 실행 계획을 비교해보는 것을 적.추(적극 추천)한다.
